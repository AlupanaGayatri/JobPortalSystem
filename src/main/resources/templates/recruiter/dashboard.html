<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/recruiter-layout}">

<head>
    <title>Dashboard</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- Welcome Section -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="text-cream mb-1">Dashboard</h2>
                <p class="text-truffle">Overview of your hiring pipeline</p>
            </div>
            <!-- Date range picker placeholder -->
            <button class="btn btn-outline-light btn-sm">
                <i class="fas fa-calendar me-2"></i> Last 30 Days
            </button>
        </div>

        <!-- KPI Cards Row -->
        <div class="dashboard-grid mb-4">
            <a href="/recruiter/jobs" class="text-decoration-none">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${activeJobsCount}">0</h3>
                        <p>Active Jobs</p>
                    </div>
                </div>
            </a>

            <a href="/recruiter/candidates" class="text-decoration-none">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${newApplicationsCount}">0</h3>
                        <p>New Applications</p>
                    </div>
                </div>
            </a>

            <a href="/recruiter/candidates" class="text-decoration-none">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${totalApplicants}">0</h3>
                        <p>Total Candidates</p>
                    </div>
                </div>
            </a>

            <a href="/recruiter/interviews" class="text-decoration-none">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3 th:text="${interviewsTodayCount}">0</h3>
                        <p>Interviews Today</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="row g-4 mb-4">
            <!-- Left Column: Hiring Funnel -->
            <div class="col-lg-7">
                <div class="form-card h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="text-gold mb-0">Hiring Funnel</h5>
                        <select class="form-select form-select-sm w-auto bg-dark text-light border-secondary">
                            <option>All Jobs</option>
                        </select>
                    </div>

                    <div class="funnel-visual d-flex flex-column align-items-center gap-3">
                        <!-- Inverted Pyramid Style -->
                        <div class="funnel-row d-flex justify-content-between align-items-center w-100 p-3 rounded"
                            style="background: rgba(255, 193, 7, 0.1); border-left: 4px solid var(--gold); width: 100%;">
                            <span class="text-cream fw-bold">Applied</span>
                            <span class="text-gold fw-bold" th:text="${funnelApplied}">120</span>
                        </div>
                        <div class="funnel-row d-flex justify-content-between align-items-center p-3 rounded"
                            style="background: rgba(255, 193, 7, 0.08); border-left: 4px solid rgba(255, 193, 7, 0.8); width: 90%;">
                            <span class="text-cream fw-bold">Shortlisted</span>
                            <span class="text-gold fw-bold" th:text="${funnelShortlisted}">45</span>
                        </div>
                        <div class="funnel-row d-flex justify-content-between align-items-center p-3 rounded"
                            style="background: rgba(255, 193, 7, 0.06); border-left: 4px solid rgba(255, 193, 7, 0.6); width: 80%;">
                            <span class="text-cream fw-bold">Interview</span>
                            <span class="text-gold fw-bold" th:text="${funnelInterview}">12</span>
                        </div>
                        <div class="funnel-row d-flex justify-content-between align-items-center p-3 rounded"
                            style="background: rgba(255, 193, 7, 0.04); border-left: 4px solid rgba(255, 193, 7, 0.4); width: 70%;">
                            <span class="text-cream fw-bold">Offer</span>
                            <span class="text-gold fw-bold" th:text="${funnelOffer}">5</span>
                        </div>
                        <div class="funnel-row d-flex justify-content-between align-items-center p-3 rounded"
                            style="background: rgba(102, 187, 106, 0.1); border-left: 4px solid #66bb6a; width: 60%;">
                            <span class="text-cream fw-bold">Hired</span>
                            <span class="text-gold fw-bold" th:text="${funnelHired}">3</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Recent Activity -->
            <div class="col-lg-5">
                <div class="form-card h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="text-gold mb-0">Recent Activity</h5>
                    </div>
                    <div class="activity-feed">
                        <div th:if="${#lists.isEmpty(recentApplications)}" class="text-center py-4 text-truffle">
                            <i class="fas fa-history mb-2"></i>
                            <p class="mb-0">No recent activity</p>
                        </div>
                        <div th:each="app : ${recentApplications}"
                            class="activity-item d-flex gap-3 mb-3 pb-3 border-bottom border-light"
                            style="border-color: rgba(255,255,255,0.05) !important;">
                            <div class="activity-icon bg-primary rounded-circle p-2 d-flex align-items-center justify-content-center"
                                style="width: 40px; height: 40px;"
                                th:classappend="${app.status == 'HIRED' ? 'bg-success' : (app.status == 'INTERVIEW' ? 'bg-info' : 'bg-primary')}">
                                <i class="fas fa-user-plus text-white" th:if="${app.status == 'APPLIED'}"></i>
                                <i class="fas fa-check text-white" th:if="${app.status == 'HIRED'}"></i>
                                <i class="fas fa-calendar-alt text-white" th:if="${app.status == 'INTERVIEW'}"></i>
                                <i class="fas fa-file-alt text-white"
                                    th:if="${app.status != 'APPLIED' && app.status != 'HIRED' && app.status != 'INTERVIEW'}"></i>
                            </div>
                            <div>
                                <h6 class="text-cream mb-1">
                                    <span th:text="${app.user.fullName}">Candidate Name</span>
                                    <span class="fw-normal text-truffle small"
                                        th:text="' - ' + ${app.status}">Status</span>
                                </h6>
                                <p class="text-truffle small mb-0">
                                    <span th:text="${app.job.title}">Job Title</span> •
                                    <span th:text="${#temporals.format(app.appliedDate, 'MMM dd, HH:mm')}">Time</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <a href="#" class="text-gold small text-decoration-none">View All Activity</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Suggested Candidates Row -->
        <div class="row">
            <div class="col-12">
                <div class="form-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="text-gold mb-0">Suggested Candidates</h5>
                        <a href="/recruiter/candidates/search" class="btn btn-sm btn-outline-light">View All</a>
                    </div>

                    <div class="table-responsive">
                        <!-- Placeholder for Suggested Candidates -->
                        <table class="table table-borderless text-cream align-middle">
                            <tbody>
                                <tr th:if="${#lists.isEmpty(suggestedCandidates)}">
                                    <td colspan="5" class="text-center py-4 text-truffle">
                                        <i class="fas fa-search mb-2"></i>
                                        <p class="mb-0">No matching candidates found based on your active jobs.</p>
                                    </td>
                                </tr>
                                <tr th:each="candidate : ${suggestedCandidates}" class="border-bottom"
                                    style="border-color: rgba(255,255,255,0.05) !important;">
                                    <td width="60">
                                        <div class="avatar-placeholder bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center"
                                            style="width: 45px; height: 45px; font-weight: bold;">
                                            <span
                                                th:text="${#strings.substring(candidate.user.fullName, 0, 1)}">U</span>
                                        </div>
                                    </td>
                                    <td>
                                        <h6 class="mb-0 text-cream" th:text="${candidate.user.fullName}">Name</h6>
                                        <small class="text-truffle">
                                            <span th:text="${candidate.profile.headline}">Headline</span>
                                            <span th:if="${candidate.profile.desiredLocation != null}"
                                                th:text="' • ' + ${candidate.profile.desiredLocation}"> •
                                                Location</span>
                                        </small>
                                    </td>
                                    <td>
                                        <div class="d-flex gap-2 flex-wrap">
                                            <span th:each="skill : ${candidate.topSkills}"
                                                class="badge rounded-pill bg-transparent border text-gold text-capitalize"
                                                style="border-color: var(--gold) !important;"
                                                th:text="${skill}">Java</span>
                                            <span th:if="${candidate.remainingSkills > 0}"
                                                class="badge rounded-pill bg-transparent border text-gold"
                                                style="border-color: var(--gold) !important;"
                                                th:text="'+' + ${candidate.remainingSkills}">+2</span>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div
                                            class="position-relative d-inline-flex align-items-center justify-content-center">
                                            <svg viewBox="0 0 36 36" class="circular-chart"
                                                th:classappend="${candidate.matchPercentage > 80 ? 'text-success' : (candidate.matchPercentage > 50 ? 'text-warning' : 'text-danger')}"
                                                style="width: 50px; height: 50px;">
                                                <path class="circle-bg"
                                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                    fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2.5" />
                                                <path class="circle"
                                                    th:attr="stroke-dasharray=${candidate.matchPercentage} + ', 100'"
                                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                                    fill="none" stroke="currentColor" stroke-width="2.5" />
                                            </svg>
                                            <span class="position-absolute small fw-bold text-cream"
                                                th:text="${candidate.matchPercentage} + '%'">92%</span>
                                        </div>
                                        <div class="small text-truffle mt-1">Match</div>
                                    </td>
                                    <td class="text-end">
                                        <div class="d-flex gap-2 justify-content-end">
                                            <a th:href="@{'/recruiter/candidates/profile/' + ${candidate.user.id}}"
                                                class="btn btn-sm btn-outline-gold rounded-circle" title="View Profile">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a th:href="'mailto:' + ${candidate.user.email}"
                                                class="btn btn-sm btn-outline-gold rounded-circle" title="Email">
                                                <i class="fas fa-envelope"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>